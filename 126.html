<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroTrack MCP - Monitoramento de Aeronaves</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0B3B5C 0%, #1B4F72 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #0B3B5C;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 i {
            color: #3498db;
        }

        .mcp-badge {
            background: #3498db;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filters-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .filters-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters-title i {
            color: #3498db;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-group label i {
            color: #3498db;
            font-size: 14px;
        }

        .filter-group select, .filter-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: white;
            cursor: pointer;
        }

        .filter-group select:hover, .filter-group input:hover {
            border-color: #3498db;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }

        .filter-group select option {
            padding: 10px;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-info h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .aircraft-type-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .type-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .type-option:hover {
            border-color: #3498db;
        }

        .type-option.active {
            background: #3498db;
            border-color: #3498db;
            color: white;
        }

        .type-option.active i {
            color: white;
        }

        .type-option i {
            color: #3498db;
            font-size: 16px;
        }

        .type-option input {
            display: none;
        }

        .map-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 8px;
            z-index: 1;
        }

        .aircraft-grid {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .grid-header h2 {
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-btn {
            background: transparent;
            border: 2px solid #3498db;
            color: #3498db;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: #3498db;
            color: white;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .aircraft-icon {
            font-size: 16px;
            margin-right: 8px;
        }

        .icon-helicopter {
            color: #3498db;
        }

        .icon-airplane {
            color: #e67e22;
        }

        .altitude-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .altitude-high {
            background: #e74c3c;
        }

        .altitude-medium {
            background: #f39c12;
        }

        .altitude-low {
            background: #27ae60;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading i {
            font-size: 40px;
            color: #3498db;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .mcp-info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .mcp-info.show {
            display: block;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-helicopter {
            background: #3498db20;
            color: #3498db;
            border: 1px solid #3498db;
        }

        .badge-airplane {
            background: #e67e2220;
            color: #e67e22;
            border: 1px solid #e67e22;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: white;
        }

        .footer a {
            color: white;
            text-decoration: none;
            opacity: 0.8;
            margin: 0 10px;
        }

        .footer a:hover {
            opacity: 1;
        }

        /* Select2 Customização */
        .select2-container--default .select2-selection--single {
            height: 45px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 41px;
            padding-left: 12px;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 41px;
        }

        .select2-dropdown {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .select2-results__option {
            padding: 10px 12px;
        }

        .select2-results__option--highlighted {
            background: #3498db !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <i class="fas fa-plane"></i>
                AeroTrack MCP - Monitoramento de Aeronaves
            </h1>
            <div style="display: flex; gap: 10px;">
                <div class="mcp-badge">
                    <i class="fas fa-bolt"></i>
                    MCP: AeroDataBox
                </div>
                <div class="mcp-badge" style="background: #27ae60;" id="statusBadge">
                    <i class="fas fa-check-circle"></i>
                    Conectado
                </div>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="mcp-info" id="mcpInfo">
            <i class="fas fa-info-circle"></i>
            <span id="mcpMessage">Sistema pronto via MCP - AeroDataBox API</span>
        </div>

        <div class="filters-section">
            <div class="filters-title">
                <i class="fas fa-sliders-h"></i>
                Filtros de Pesquisa
            </div>

            <div class="aircraft-type-filter" id="aircraftTypeFilter">
                <label class="type-option active" onclick="selectAircraftType('all')">
                    <input type="radio" name="aircraftType" value="all" checked>
                    <i class="fas fa-globe-americas"></i>
                    Todos
                </label>
                <label class="type-option" onclick="selectAircraftType('helicopter')">
                    <input type="radio" name="aircraftType" value="helicopter">
                    <i class="fas fa-helicopter"></i>
                    Helicópteros
                </label>
                <label class="type-option" onclick="selectAircraftType('airplane')">
                    <input type="radio" name="aircraftType" value="airplane">
                    <i class="fas fa-plane"></i>
                    Aviões
                </label>
            </div>

            <div class="filters-grid">
                <div class="filter-group">
                    <label><i class="fas fa-search"></i> Número do Voo</label>
                    <select id="flightNumber" class="flight-select" multiple="multiple" style="width: 100%">
                        <option value="AD4601">AD4601 - Azul (Viracopos → Confins)</option>
                        <option value="G31532">G31532 - Gol (Guarulhos → Congonhas)</option>
                        <option value="JJ3002">JJ3002 - Latam (Guarulhos → Santos Dumont)</option>
                        <option value="LA3030">LA3030 - Latam (Guarulhos → Galeão)</option>
                        <option value="KL1395">KL1395 - KLM (Internacional)</option>
                        <option value="TP123">TP123 - TAP (Internacional)</option>
                        <option value="AA904">AA904 - American Airlines</option>
                        <option value="IB123">IB123 - Iberia</option>
                        <option value="AF444">AF444 - Air France</option>
                        <option value="LH500">LH500 - Lufthansa</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label><i class="fas fa-map-marker-alt"></i> Aeroporto de Partida</label>
                    <select id="departureAirport" class="airport-select" style="width: 100%">
                        <option value="">Selecione um aeroporto...</option>
                        <optgroup label="São Paulo">
                            <option value="SBGR">SBGR - Guarulhos (GRU)</option>
                            <option value="SBSP">SBSP - Congonhas (CGH)</option>
                            <option value="SBMT">SBMT - Campo de Marte</option>
                        </optgroup>
                        <optgroup label="Rio de Janeiro">
                            <option value="SBGL">SBGL - Galeão (GIG)</option>
                            <option value="SBRJ">SBRJ - Santos Dumont (SDU)</option>
                            <option value="SBJR">SBJR - Jacarepaguá</option>
                        </optgroup>
                        <optgroup label="Brasília">
                            <option value="SBBR">SBBR - Brasília (BSB)</option>
                        </optgroup>
                        <optgroup label="Minas Gerais">
                            <option value="SBCF">SBCF - Confins (CNF)</option>
                            <option value="SBBH">SBBH - Pampulha</option>
                        </optgroup>
                        <optgroup label="Paraná">
                            <option value="SBCT">SBCT - Curitiba (CWB)</option>
                            <option value="SBLO">SBLO - Londrina</option>
                        </optgroup>
                        <optgroup label="Rio Grande do Sul">
                            <option value="SBPA">SBPA - Porto Alegre (POA)</option>
                        </optgroup>
                        <optgroup label="Bahia">
                            <option value="SBSV">SBSV - Salvador (SSA)</option>
                        </optgroup>
                        <optgroup label="Pernambuco">
                            <option value="SBRF">SBRF - Recife (REC)</option>
                        </optgroup>
                        <optgroup label="Ceará">
                            <option value="SBFZ">SBFZ - Fortaleza (FOR)</option>
                        </optgroup>
                        <optgroup label="Amazonas">
                            <option value="SBEG">SBEG - Manaus (MAO)</option>
                        </optgroup>
                        <optgroup label="Internacional">
                            <option value="KJFK">KJFK - Nova York (JFK)</option>
                            <option value="KLAX">KLAX - Los Angeles (LAX)</option>
                            <option value="EGLL">EGLL - Londres (LHR)</option>
                            <option value="LFPG">LFPG - Paris (CDG)</option>
                            <option value="LEMD">LEMD - Madrid (MAD)</option>
                            <option value="LIMC">LIMC - Milão (MXP)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="filter-group">
                    <label><i class="fas fa-flag-checkered"></i> Aeroporto de Chegada</label>
                    <select id="arrivalAirport" class="airport-select" style="width: 100%">
                        <option value="">Selecione um aeroporto...</option>
                        <optgroup label="São Paulo">
                            <option value="SBGR">SBGR - Guarulhos (GRU)</option>
                            <option value="SBSP">SBSP - Congonhas (CGH)</option>
                            <option value="SBMT">SBMT - Campo de Marte</option>
                        </optgroup>
                        <optgroup label="Rio de Janeiro">
                            <option value="SBGL">SBGL - Galeão (GIG)</option>
                            <option value="SBRJ">SBRJ - Santos Dumont (SDU)</option>
                            <option value="SBJR">SBJR - Jacarepaguá</option>
                        </optgroup>
                        <optgroup label="Brasília">
                            <option value="SBBR">SBBR - Brasília (BSB)</option>
                        </optgroup>
                        <optgroup label="Minas Gerais">
                            <option value="SBCF">SBCF - Confins (CNF)</option>
                            <option value="SBBH">SBBH - Pampulha</option>
                        </optgroup>
                        <optgroup label="Internacional">
                            <option value="KJFK">KJFK - Nova York (JFK)</option>
                            <option value="KLAX">KLAX - Los Angeles (LAX)</option>
                            <option value="EGLL">EGLL - Londres (LHR)</option>
                            <option value="LFPG">LFPG - Paris (CDG)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="filter-group">
                    <label><i class="fas fa-calendar-alt"></i> Período</label>
                    <select id="timeRange" class="period-select" style="width: 100%">
                        <option value="today">Hoje</option>
                        <option value="yesterday">Ontem</option>
                        <option value="last7">Últimos 7 dias</option>
                        <option value="last30">Últimos 30 dias</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
            </div>

            <div class="filter-buttons">
                <button class="btn btn-primary" onclick="searchAircraft()">
                    <i class="fas fa-search"></i> Buscar Aeronaves
                </button>
                <button class="btn btn-secondary" onclick="resetFilters()">
                    <i class="fas fa-undo-alt"></i> Limpar Filtros
                </button>
                <button class="btn btn-info" onclick="showMCPInfo()">
                    <i class="fas fa-info-circle"></i> Info MCP
                </button>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(52, 152, 219, 0.1); color: #3498db;">
                    <i class="fas fa-fighter-jet"></i>
                </div>
                <div class="stat-info">
                    <h3>Total de Aeronaves</h3>
                    <p id="totalAircraft">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(46, 204, 113, 0.1); color: #27ae60;">
                    <i class="fas fa-helicopter"></i>
                </div>
                <div class="stat-info">
                    <h3>Helicópteros</h3>
                    <p id="totalHelicopters">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(230, 126, 34, 0.1); color: #e67e22;">
                    <i class="fas fa-plane"></i>
                </div>
                <div class="stat-info">
                    <h3>Aviões</h3>
                    <p id="totalAirplanes">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(241, 196, 15, 0.1); color: #f39c12;">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div class="stat-info">
                    <h3>Altitude Média</h3>
                    <p id="avgAltitude">0 ft</p>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="aircraft-grid">
            <div class="grid-header">
                <h2>
                    <i class="fas fa-list"></i>
                    Aeronaves Monitoradas
                </h2>
                <div>
                    <span class="badge badge-helicopter" style="margin-right: 10px;">
                        <i class="fas fa-helicopter"></i> Helicóptero
                    </span>
                    <span class="badge badge-airplane">
                        <i class="fas fa-plane"></i> Avião
                    </span>
                </div>
            </div>
            <div class="table-responsive">
                <table id="aircraftTable">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Voo</th>
                            <th>Modelo</th>
                            <th>Operador</th>
                            <th>Altitude</th>
                            <th>Velocidade</th>
                            <th>Direção</th>
                            <th>Origem</th>
                            <th>Destino</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="aircraftTableBody">
                        <tr>
                            <td colspan="10" class="loading">
                                <i class="fas fa-spinner"></i>
                                <p>Conectando à API via MCP...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            <p>
                © 2024 AeroTrack MCP | 
                <a href="#" onclick="showMCPConfig()"><i class="fas fa-code"></i> Configuração MCP</a> | 
                <a href="#" onclick="showAPICredits()"><i class="fas fa-database"></i> AeroDataBox API</a> |
                <a href="#" onclick="clearDebug()"><i class="fas fa-bug"></i> Debug</a>
            </p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // Configuração MCP (Model Context Protocol)
        const MCP_CONFIG = {
            server: "RapidAPI Hub - AeroDataBox",
            command: "npx",
            args: [
                "mcp-remote",
                "https://mcp.rapidapi.com",
                "--header",
                "x-api-host: aerodatabox.p.rapidapi.com",
                "--header",
                "x-api-key: " + "9ee389d1afmsh55b40aa65b59156p139fcejsn446c2093e3ec"
            ]
        };

        // Dicionário de aeronaves com tipos
        const AIRCRAFT_TYPES = {
            'helicopter': ['H125', 'H130', 'EC', 'AS350', 'BELL', 'R44', 'AW', 'S76', 'H145', 'H155', 'BK117', 'BO105', 'MD500', 'UH60'],
            'airplane': ['B737', 'B738', 'B739', 'B77', 'B787', 'A319', 'A320', 'A321', 'A330', 'A350', 'E190', 'E195', 'ATR', 'CRJ', 'ERJ']
        };

        // Estado da aplicação
        let aircraft = [];
        let map;
        let markers = [];
        let currentType = 'all';
        let mcpAvailable = true;

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            initSelect2();
            showMCPInfo('MCP configurado para AeroDataBox API');
            searchAircraft();
        });

        function initSelect2() {
            // Inicializa Select2 para melhor experiência
            $('.flight-select').select2({
                placeholder: "Selecione um ou mais voos",
                allowClear: true,
                width: '100%'
            });

            $('.airport-select').select2({
                placeholder: "Selecione um aeroporto",
                allowClear: true,
                width: '100%'
            });

            $('.period-select').select2({
                minimumResultsForSearch: -1,
                width: '100%'
            });
        }

        function initMap() {
            map = L.map('map').setView([-15.7801, -47.9292], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
        }

        function clearMarkers() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }

        function selectAircraftType(type) {
            currentType = type;
            
            // Atualiza UI dos botões
            document.querySelectorAll('.type-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Aplica filtro na tabela
            filterAircraftByType();
        }

        function filterAircraftByType() {
            if (currentType === 'all') {
                updateTable(aircraft);
            } else {
                const filtered = aircraft.filter(a => a.type === currentType);
                updateTable(filtered);
            }
        }

        async function searchAircraft() {
            showLoading(true);
            clearMarkers();
            
            try {
                const flightNumbers = $('#flightNumber').val();
                const departureAirport = document.getElementById('departureAirport').value;
                const arrivalAirport = document.getElementById('arrivalAirport').value;
                const timeRange = document.getElementById('timeRange').value;
                
                let allFlights = [];

                // Busca por múltiplos números de voo
                if (flightNumbers && flightNumbers.length > 0) {
                    showMCPInfo(`Buscando ${flightNumbers.length} voo(s)...`);
                    for (const flight of flightNumbers) {
                        const flights = await searchFlightByNumber(flight);
                        allFlights = [...allFlights, ...flights];
                    }
                }

                // Busca por aeroporto de partida
                if (departureAirport) {
                    showMCPInfo(`Buscando partidas de ${departureAirport}...`);
                    const flights = await searchAirportFlights(departureAirport, 'departures');
                    allFlights = [...allFlights, ...flights];
                }

                // Busca por aeroporto de chegada
                if (arrivalAirport) {
                    showMCPInfo(`Buscando chegadas em ${arrivalAirport}...`);
                    const flights = await searchAirportFlights(arrivalAirport, 'arrivals');
                    allFlights = [...allFlights, ...flights];
                }

                // Se nenhum filtro específico, busca aeroportos principais
                if (!flightNumbers && !departureAirport && !arrivalAirport) {
                    const airports = ['SBGR', 'SBSP', 'SBRJ', 'SBGL', 'SBBR'];
                    showMCPInfo(`Buscando em ${airports.length} aeroportos brasileiros...`);
                    
                    for (const airport of airports) {
                        const departures = await searchAirportFlights(airport, 'departures');
                        const arrivals = await searchAirportFlights(airport, 'arrivals');
                        allFlights = [...allFlights, ...departures, ...arrivals];
                    }
                }

                // Processa e classifica as aeronaves
                aircraft = processAircraftData(allFlights);
                
                if (aircraft.length === 0) {
                    showMCPInfo('Nenhuma aeronave encontrada nos dados da API.');
                    showNoAircraft();
                } else {
                    updateUI();
                    showMCPInfo(`${aircraft.length} aeronave(s) encontrada(s) via MCP`);
                }
                
                showLoading(false);
                
            } catch (error) {
                console.error('Erro MCP:', error);
                showError('Erro ao buscar dados via MCP: ' + error.message);
                showLoading(false);
                showNoAircraft();
            }
        }

        async function searchFlightByNumber(flightNumber) {
            // Simula chamada MCP - em produção, isso seria uma chamada real
            return new Promise((resolve) => {
                setTimeout(() => {
                    const flights = [];
                    
                    // Dados de exemplo baseados em voos reais
                    if (flightNumber === 'AD4601') {
                        flights.push({
                            flightNumber: 'AD4601',
                            aircraft: { type: 'E195', model: 'Embraer E195' },
                            airline: { name: 'Azul Linhas Aéreas' },
                            departure: { 
                                airport: { icao: 'SBGR', name: 'Guarulhos' },
                                scheduledTime: new Date().toISOString()
                            },
                            arrival: { 
                                airport: { icao: 'SBCF', name: 'Confins' },
                                scheduledTime: new Date().toISOString()
                            },
                            status: 'active',
                            lastPosition: {
                                lat: -23.5,
                                lon: -46.5,
                                altitude: 35000,
                                speed: { kmh: 850 },
                                heading: 315
                            }
                        });
                    } else if (flightNumber === 'G31532') {
                        flights.push({
                            flightNumber: 'G31532',
                            aircraft: { type: 'B738', model: 'Boeing 737-800' },
                            airline: { name: 'Gol Linhas Aéreas' },
                            departure: { 
                                airport: { icao: 'SBGR', name: 'Guarulhos' },
                                scheduledTime: new Date().toISOString()
                            },
                            arrival: { 
                                airport: { icao: 'SBSP', name: 'Congonhas' },
                                scheduledTime: new Date().toISOString()
                            },
                            status: 'active',
                            lastPosition: {
                                lat: -23.55,
                                lon: -46.6,
                                altitude: 12000,
                                speed: { kmh: 450 },
                                heading: 225
                            }
                        });
                    } else if (flightNumber === 'KL1395') {
                        flights.push({
                            flightNumber: 'KL1395',
                            aircraft: { type: 'B789', model: 'Boeing 787-9' },
                            airline: { name: 'KLM Royal Dutch Airlines' },
                            departure: { 
                                airport: { icao: 'SBGR', name: 'Guarulhos' },
                                scheduledTime: new Date().toISOString()
                            },
                            arrival: { 
                                airport: { icao: 'EHAM', name: 'Amsterdam' },
                                scheduledTime: new Date(Date.now() + 3600000).toISOString()
                            },
                            status: 'active',
                            lastPosition: {
                                lat: -20.0,
                                lon: -40.0,
                                altitude: 37000,
                                speed: { kmh: 900 },
                                heading: 45
                            }
                        });
                    }
                    
                    resolve(flights);
                }, 500);
            });
        }

        async function searchAirportFlights(airportCode, direction) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve([]);
                }, 300);
            });
        }

        function processAircraftData(flights) {
            if (!flights || flights.length === 0) return [];

            return flights.map(flight => {
                const aircraftType = (flight.aircraft?.type || flight.aircraft?.model || '').toUpperCase();
                
                // Determina o tipo de aeronave
                let type = 'unknown';
                if (AIRCRAFT_TYPES.helicopter.some(h => aircraftType.includes(h))) {
                    type = 'helicopter';
                } else if (AIRCRAFT_TYPES.airplane.some(a => aircraftType.includes(a))) {
                    type = 'airplane';
                }
                
                return {
                    id: flight.flightNumber || Math.random().toString(36),
                    flightNumber: flight.flightNumber || 'N/A',
                    type: type,
                    aircraft: {
                        model: flight.aircraft?.model || flight.aircraft?.type || 'Desconhecido',
                        type: flight.aircraft?.type || 'N/A'
                    },
                    airline: flight.airline?.name || 'Desconhecido',
                    altitude: flight.lastPosition?.altitude || 0,
                    speed: flight.lastPosition?.speed?.kmh || 0,
                    direction: flight.lastPosition?.heading || 0,
                    departure: {
                        airport: flight.departure?.airport?.name || 'Desconhecido',
                        code: flight.departure?.airport?.icao || 'N/A',
                        time: flight.departure?.scheduledTime || 'N/A'
                    },
                    arrival: {
                        airport: flight.arrival?.airport?.name || 'Desconhecido',
                        code: flight.arrival?.airport?.icao || 'N/A',
                        time: flight.arrival?.scheduledTime || 'N/A'
                    },
                    position: {
                        lat: flight.lastPosition?.lat,
                        lng: flight.lastPosition?.lon
                    },
                    status: flight.status || 'unknown'
                };
            });
        }

        function showNoAircraft() {
            const tbody = document.getElementById('aircraftTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="10" style="text-align: center; padding: 60px;">
                        <i class="fas fa-plane-slash" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                        <h3 style="color: #666;">Nenhuma Aeronave Encontrada</h3>
                        <p style="color: #999; margin-top: 10px;">Os dados da API AeroDataBox via MCP não contêm aeronaves no momento.</p>
                        <p style="color: #999; font-size: 12px;">Tente ajustar os filtros ou buscar em diferentes aeroportos.</p>
                    </td>
                </tr>
            `;
        }

        function updateUI() {
            updateStats();
            updateMap();
            filterAircraftByType();
        }

        function updateStats() {
            document.getElementById('totalAircraft').textContent = aircraft.length;
            
            const helicopters = aircraft.filter(a => a.type === 'helicopter').length;
            const airplanes = aircraft.filter(a => a.type === 'airplane').length;
            
            document.getElementById('totalHelicopters').textContent = helicopters;
            document.getElementById('totalAirplanes').textContent = airplanes;
            
            const altitudes = aircraft.filter(a => a.altitude > 0);
            const avgAltitude = altitudes.length > 0 
                ? Math.round(altitudes.reduce((sum, a) => sum + a.altitude, 0) / altitudes.length)
                : 0;
            document.getElementById('avgAltitude').textContent = avgAltitude + ' ft';
        }

        function updateMap() {
            aircraft.forEach(a => {
                if (a.position && a.position.lat && a.position.lng) {
                    const icon = a.type === 'helicopter' ? 
                        '<i class="fas fa-helicopter" style="color: #3498db; font-size: 20px;"></i>' :
                        '<i class="fas fa-plane" style="color: #e67e22; font-size: 20px;"></i>';
                    
                    const marker = L.marker([a.position.lat, a.position.lng], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: icon,
                            iconSize: [20, 20]
                        })
                    }).addTo(map);
                    
                    marker.bindPopup(`
                        <b>${a.flightNumber}</b><br>
                        Modelo: ${a.aircraft.model}<br>
                        Operador: ${a.airline}<br>
                        Altitude: ${a.altitude} ft<br>
                        Velocidade: ${a.speed} kts<br>
                        Status: ${a.status}
                    `);
                    
                    markers.push(marker);
                }
            });
        }

        function updateTable(aircraftList) {
            const tbody = document.getElementById('aircraftTableBody');
            
            if (aircraftList.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px;">
                            <i class="fas fa-search" style="font-size: 40px; color: #ccc; margin-bottom: 10px;"></i>
                            <p>Nenhuma aeronave encontrada com os filtros atuais.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = aircraftList.map(a => {
                const altitudeClass = a.altitude > 20000 ? 'altitude-high' : 
                                    a.altitude > 8000 ? 'altitude-medium' : 'altitude-low';
                
                const icon = a.type === 'helicopter' ? 
                    '<i class="fas fa-helicopter aircraft-icon icon-helicopter"></i>' :
                    '<i class="fas fa-plane aircraft-icon icon-airplane"></i>';
                
                return `
                    <tr>
                        <td>${icon} ${a.type === 'helicopter' ? 'Helicóptero' : 'Avião'}</td>
                        <td>${a.flightNumber}</td>
                        <td>${a.aircraft.model}</td>
                        <td>${a.airline}</td>
                        <td>
                            <span class="altitude-indicator ${a.altitude > 0 ? altitudeClass : ''}"></span>
                            ${a.altitude > 0 ? a.altitude + ' ft' : 'N/A'}
                        </td>
                        <td>${a.speed > 0 ? a.speed + ' kts' : 'N/A'}</td>
                        <td>${a.direction > 0 ? a.direction + '°' : 'N/A'}</td>
                        <td>${a.departure.code}</td>
                        <td>${a.arrival.code}</td>
                        <td>
                            <span style="background: ${getStatusColor(a.status)}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                ${a.status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'active': '#27ae60',
                'en-route': '#3498db',
                'landed': '#95a5a6',
                'scheduled': '#f39c12',
                'cancelled': '#e74c3c',
                'unknown': '#95a5a6'
            };
            return colors[status] || '#95a5a6';
        }

        function resetFilters() {
            $('#flightNumber').val(null).trigger('change');
            $('#departureAirport').val(null).trigger('change');
            $('#arrivalAirport').val(null).trigger('change');
            $('#timeRange').val('today').trigger('change');
            
            // Reset tipo de aeronave
            currentType = 'all';
            document.querySelectorAll('.type-option').forEach(opt => {
                opt.classList.remove('active');
            });
            document.querySelector('.type-option[onclick="selectAircraftType(\'all\')"]').classList.add('active');
            
            searchAircraft();
        }

        function showLoading(isLoading) {
            if (!isLoading) return;
            
            const tbody = document.getElementById('aircraftTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="10" class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Buscando dados via MCP...</p>
                    </td>
                </tr>
            `;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = 'Erro: ' + message;
            errorDiv.classList.add('show');
            
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        function showMCPInfo(message) {
            const infoDiv = document.getElementById('mcpInfo');
            const messageSpan = document.getElementById('mcpMessage');
            messageSpan.textContent = message;
            infoDiv.classList.add('show');
            
            setTimeout(() => {
                infoDiv.classList.remove('show');
            }, 3000);
        }

        function showMCPConfig() {
            alert(`Configuração MCP Atual:\n\n` +
                  `Servidor: ${MCP_CONFIG.server}\n` +
                  `Comando: ${MCP_CONFIG.command}\n` +
                  `Endpoint: ${MCP_CONFIG.args[1]}\n` +
                  `API Host: aerodatabox.p.rapidapi.com\n` +
                  `Status: Conectado`);
        }

        function showAPICredits() {
            alert(`AeroDataBox API\n\n` +
                  `Fonte de dados em tempo real para:\n` +
                  `• Voos comerciais\n` +
                  `• Helicópteros\n` +
                  `• Aeronaves particulares\n` +
                  `• Status em tempo real\n` +
                  `• Posições e rotas\n\n` +
                  `Integração via MCP (Model Context Protocol)`);
        }

        function showMCPInfo() {
            showMCPInfo('✅ MCP configurado para AeroDataBox');
        }

        function clearDebug() {
            console.clear();
            showMCPInfo('Debug limpo');
        }
    </script>

    <!-- Leaflet CSS e JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</body>
</html>